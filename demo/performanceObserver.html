<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>performanceObserver</title>
    <style>
        body {
            /* æ³¨æ„ï¼šç™½è‰²èƒŒæ™¯è‰²ä¸ç®—FP */
            background-color: ghostwhite;
        }
    </style>
    <script>
        console.warn('ç½‘ç»œå¾€è¿”æ—¶å»¶â°', navigator.connection.rtt)
        var headEnding = +new Date;
    </script>
</head>
<body>

    <div id='root'>
        FCP ç›‘å¬çš„é¦–æ¬¡ç»˜åˆ¶å†…å®¹
    </div>
    <script>
        // PerformanceObserver ç”¨äºç›‘æµ‹æ€§èƒ½åº¦é‡äº‹ä»¶ï¼Œåœ¨æµè§ˆå™¨çš„æ€§èƒ½æ—¶é—´è½´è®°å½•ä¸‹ä¸€ä¸ªæ–°çš„ performance entries  çš„æ—¶å€™å°†ä¼šè¢«é€šçŸ¥
        // åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ PerformanceObserver å¯¹è±¡
        /* FP & FCP */
        const observerPaint = new PerformanceObserver(perf_observer);
        function perf_observer(list, observer) {
            for (const entry of list.getEntries()) {
                console.group('PerformanceObserver-paint:', entry.name);
                console.log(entry);
                console.log('ç±»å‹ğŸš€', entry.entryType);
                console.log('å…·ä½“æŒ‡æ ‡ğŸš€', entry.name);
                console.log('å¼€å§‹æ—¶é—´â°', entry.startTime);
                console.log('durationâŒšï¸', entry.duration);
                console.groupEnd();
            }
        }
        observerPaint.observe({ entryTypes: ['paint'] });


        /* FMP */
        const observerMark = new PerformanceObserver(perf_observer);
        function perf_observer(list, observer) {
            for (const entry of list.getEntries()) {
                console.group('PerformanceObserver-mark:', entry.name);
                console.log(entry);
                console.log('ç±»å‹ğŸš€', entry.entryType);
                console.log('å…·ä½“æŒ‡æ ‡ğŸš€', entry.name);
                console.log('å¼€å§‹æ—¶é—´â°', entry.startTime);
                console.log('durationâŒšï¸', entry.duration);
                console.groupEnd();
            }
        }
        observerMark.observe({ entryTypes: ['mark'] });


        /* Long Task */
        const observerLongtask = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
                console.group('PerformanceObserver-longtask:', entry.name);
                console.log(entry.attribution[0]);
                console.error('ç±»å‹ğŸš€', entry.entryType);
                console.log('å…·ä½“æŒ‡æ ‡ğŸš€', entry.name);
                console.log('å¼€å§‹æ—¶é—´â°', entry.startTime);
                console.log('durationâŒšï¸', entry.duration);
                console.groupEnd();
            }
        });
        observerLongtask.observe({ entryTypes: ['longtask'] });
    </script>
    <script>
        var ending1 = +new Date;
    </script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
    <script>
        var ending2 = +new Date;
        function longtaskFun(params) {
            let x = 0;
            for (let index = 0; index < 100000; index++) {
                x++;
            }
        }
        longtaskFun();
        console.warn('-----script parser end-----, domInteractive is ', performance.timing.domInteractive);
    </script>
    <script>
        // æ¨¡æ‹ŸcomponentDidMound fetch
        setTimeout(() => {
            // æ•°æ®å›æ¥åè¿›è¡Œæ—¶é—´ç‚¹æ ‡è®°
            performance.mark('FMP');
        }, 200);
    </script>
    <script src="./tti-polyfill.js"></script>
    <script>
        document.addEventListener('readystatechange', (event) => {
            const {
                navigationStart,
                domLoading,
                domInteractive,
                domContentLoadedEventStart,
                domContentLoadedEventEnd,
                domComplete,
            } = performance.timing;
            console.group('addEventListener-readystatechange:', document.readyState);
            console.log('domLoading', domLoading - navigationStart);
            console.log('domInteractive', domInteractive - navigationStart);
            console.log('domContentLoadedEventStart', domContentLoadedEventStart - navigationStart);
            console.log('domContentLoadedEventEnd', domContentLoadedEventEnd - navigationStart);
            console.log('domComplete', domComplete - navigationStart);
            console.log('headæ ‡ç­¾ç»“æŸ', window.headEnding - navigationStart);
            console.log('jså¤–é“¾è„šæœ¬æ‰§è¡Œå‰', window.ending1 - navigationStart);
            console.log('jså¤–é“¾è„šæœ¬æ‰§è¡Œå', window.ending2 - navigationStart);
            console.log('æ‰€æœ‰è„šæœ¬æ‰§è¡Œå®Œæ¯•', window.ending3 - navigationStart);
            console.log('paint', performance.getEntriesByType('paint'));
            console.log('mark', performance.getEntriesByType('mark'));
            console.log('longtask', performance.getEntriesByType('long-task'));
            console.groupEnd();
        });

        ttiPolyfill.getFirstConsistentlyInteractive().then((tti) => {
            console.warn('ç”¨æˆ·å¯äº¤äº’æ—¶é—´ğŸ¦ğŸ¦', tti);
        });

        var ending3 = +new Date;
    </script>
</body>
</html>